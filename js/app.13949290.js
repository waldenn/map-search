webpackJsonp([1],{"+VGo":function(t,e){},0:function(t,e,a){t.exports=a("NHnr")},1:function(t,e){},"7fcv":function(t,e){},EYnv:function(t,e){},FfND:function(t,e){},NHnr:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});a("EuXz");var n=a("/5sW"),i=a("PlbA"),o=a.n(i),s=(a("VjuZ"),new n["a"]),r={name:"mapitem",props:{map:!1,activeInit:!1},data:function(){return{active:this.activeInit}},methods:{refineTitle:function(t){return t.slice(5).replace(/\.[^/.]+$/,"").replace(/_/g," ")},clicked:function(){this.active?(this.active=!1,this.toggleURLHash(""),s.$emit("clearLayers")):(this.active=!0,s.$emit("selected",this.map))},toggleFullscreen:function(){s.$emit("toggleFullscreen")},toggleURLHash:function(t){window.location.hash="#"+t}},mounted:function(){var t=this;this.active&&(s.$emit("selected",this.map),this.toggleURLHash(this.map.id)),s.$on("selected",function(e){e.id!==t.map.id&&(t.active=!1),t.toggleURLHash(e.id)})}},c=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.map?a("li",[a("div",{staticClass:"main",on:{click:t.clicked}},[a("img",{attrs:{src:t.map.attributes.thumb_url}}),a("div",[a("h3",[t._v(t._s(t.refineTitle(t.map.attributes.title)))])])]),t.active?a("div",{staticClass:"extended"},[a("button",{staticClass:"mw-ui-button mw-ui-progressive mw-ui-block margin-top-5",on:{click:t.toggleFullscreen}},[t._v("View Map")]),a("h4",[t._v("Open in:")]),a("a",{attrs:{href:"https://commons.wikimedia.org/wiki/File:"+t.map.attributes.unique_id}},[t._v("Wikimedia Commons")]),a("a",{attrs:{href:"https://warper.wmflabs.org/maps/"+t.map.id}},[t._v("Wikimaps Warper")]),a("h4",[t._v("Export as:")]),a("a",{attrs:{href:t.map.links.geotiff,download:""}},[t._v("GeoTiff")]),a("a",{attrs:{href:t.map.links.png,download:""}},[t._v("PNG")]),a("a",{attrs:{href:t.map.links.kml,download:""}},[t._v("KML")]),a("p",[t._v("Copyright holder and licensing information can be found on Wikimedia Commons.")])]):t._e()]):t._e()},u=[],l=a("XyMi");function m(t){a("mt4w")}var p=!1,d=m,h="data-v-04abc12e",f=null,g=Object(l["a"])(r,c,u,p,d,h,f),v=g.exports,b=a("8kuj"),w=a.n(b),_={name:"sidebar",components:{mapitem:v,Spinner:w.a},props:{featuredMap:!1},data:function(){return{searchResult:[],searchText:"",bbox:!1,searchStatus:"not-executed"}},computed:{username:function(){return tt.state.username}},methods:{search:function(t,e){var a=this;e&&e.preventDefault(),this.searchStatus="executing";var n="";s.$emit("getBounds",function(t){n="&bbox=".concat(t.getWest(),",").concat(t.getSouth(),",").concat(t.getEast(),",").concat(t.getNorth())});var i="maps.json?query=".concat(t,"&show_warped=1&per_page=20");this.bbox&&(i+=n),this.searchResult=[],this.$http.get(i).then(function(t){a.searchResult=t.body.data,a.searchStatus="done"})},signIn:function(){var t="https://warper.wmflabs.org",e=window.open(t+"/u/auth/mediawiki?omniauth_window_type=newWindow&auth_origin_url="+window.location.href,"myWindow"),a=setInterval(function(){var a="requestCredentials";e.postMessage(a,t)},500);window.addEventListener("message",function(e){e.origin===t&&(clearInterval(a),tt.commit("signIn",e.data))},!1)},signOut:function(){tt.commit("signOut")}}},k=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"sidebar"},[a("h1",[t._v("Search Maps")]),t.username?t._e():a("button",{staticClass:"mw-ui-button mw-ui-constructive sign-in",on:{click:t.signIn}},[t._v("Sign in")]),t.username?a("button",{staticClass:"mw-ui-button mw-ui-constructive sign-in",attrs:{title:"Signed in as "+t.username},on:{click:t.signOut}},[t._v("Sign out")]):t._e(),a("form",[a("input",{directives:[{name:"model",rawName:"v-model",value:t.searchText,expression:"searchText"}],staticClass:"mw-ui-input",attrs:{type:"text",placeholder:"Search by title"},domProps:{value:t.searchText},on:{input:function(e){e.target.composing||(t.searchText=e.target.value)}}}),a("label",{staticClass:"mw-ui-radio-label margin-top-5"},[t._v("\n            Limit search to current map view.\n            "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.bbox,expression:"bbox"}],staticClass:"mw-ui-checkbox",attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.bbox)?t._i(t.bbox,null)>-1:t.bbox},on:{change:function(e){var a=t.bbox,n=e.target,i=!!n.checked;if(Array.isArray(a)){var o=null,s=t._i(a,o);n.checked?s<0&&(t.bbox=a.concat([o])):s>-1&&(t.bbox=a.slice(0,s).concat(a.slice(s+1)))}else t.bbox=i}}})]),a("button",{staticClass:"mw-ui-button mw-ui-constructive mw-ui-block margin-top-5",on:{click:function(e){t.search(t.searchText,e)}}},[t._v("Search")])]),t.searchResult.length>0||"done"===t.searchStatus?a("h2",[t._v("Search Result")]):t._e(),"executing"===t.searchStatus?a("spinner",{staticClass:"margin-top-14",attrs:{"line-fg-color":"#00af89"}}):t._e(),"done"===t.searchStatus&&0===t.searchResult.length?a("p",[t._v("No results found.")]):t._e(),t.searchResult.length>0?a("ul",{staticClass:"result-list"},t._l(t.searchResult,function(t){return a("mapitem",{key:t.id,attrs:{map:t}})})):t._e(),t.featuredMap?a("h2",[t._v("Highlight")]):t._e(),t.featuredMap?a("ul",{staticClass:"result-list"},[a("mapitem",{attrs:{map:t.featuredMap,activeInit:!0}})],1):t._e()],1)},x=[];function y(t){a("ggt2")}var C=!1,S=y,$="data-v-10f6ff09",M=null,L=Object(l["a"])(_,k,x,C,S,$,M),T=L.exports,O=(a("mJx5"),a("nrd6")),R=a.n(O),E=(a("kD+0"),a("GfXl"),a("EYnv"),a("FfND"),a("SFzb"),a("e0XP"),{name:"leaflet",mounted:function(){var t=R.a.map("leaflet",{attributionControl:!1,fullscreenControl:!0,center:[40,10],zoom:3});R.a.tileLayer("https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}.png",{attribution:'Background &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(t);var e=R.a.layerGroup().addTo(t);R.a.control.attribution({prefix:""}).addTo(t),t.zoomControl.setPosition("topright"),t.fullscreenControl.setPosition("topright"),R.a.control.locate({position:"topright"}).addTo(t),s.$on("selected",function(a){e.clearLayers(),e.addLayer(R.a.tileLayer.wms(a.links.wms,{layers:"MapWarper",format:"image/png",attribution:'<a href="https://commons.wikimedia.org/wiki/'.concat(a.attributes.title,'">Wikimedia Commons</a>')}));var n=a.attributes.bbox.split(",");t.fitBounds([[n[3],n[2]],[n[1],n[0]]])}),s.$on("clearLayers",function(){e.clearLayers()}),s.$on("getBounds",function(e){e(t.getBounds())}),s.$on("toggleFullscreen",function(){t.toggleFullscreen()})}}),F=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"leaflet"}})},N=[];function W(t){a("7fcv")}var I=!1,P=W,j="data-v-8fd2d8ca",H=null,z=Object(l["a"])(E,F,N,I,P,j,H),G=z.exports,A={name:"app",components:{sidebar:T,leaflet:G},asyncComputed:{map:{get:function(){var t=window.location.hash.substring(1);return console.log(t),t?this.$http.get("maps/"+t).then(function(t){return t.body.data}):this.featuredMap()}},featuredMap:{get:function(){var t=["86"];return this.$http.get("maps/"+t[Math.floor(Math.random()*t.length)]).then(function(t){return t.body.data})},default:!1}}},B=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("sidebar",{attrs:{featuredMap:t.map}}),a("leaflet")],1)},X=[];function D(t){a("+VGo")}var U=!1,V=D,q=null,Y=null,J=Object(l["a"])(A,B,X,U,V,q,Y),K=J.exports,Z=a("8+8L"),Q=a("NYxO");a.d(e,"store",function(){return tt}),n["a"].use(o.a),n["a"].use(Z["a"]),n["a"].use(Q["a"]),n["a"].config.productionTip=!1,n["a"].http.options.root="https://warper.wmflabs.org/api/v1";var tt=new Q["a"].Store({state:{username:null,token:null},mutations:{signIn:function(t,e){t.token=e.auth_token,t.username=e.name},signOut:function(t){t.token=null,t.username=null}}});new n["a"]({render:function(t){return t(K)}}).$mount("#app")},SFzb:function(t,e){},e0XP:function(t,e){},ggt2:function(t,e){},mt4w:function(t,e){}},[0]);
//# sourceMappingURL=app.13949290.js.map