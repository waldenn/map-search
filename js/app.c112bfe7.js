webpackJsonp([1],{"+VGo":function(t,e){},0:function(t,e,a){t.exports=a("NHnr")},1:function(t,e){},"7fcv":function(t,e){},EYnv:function(t,e){},FfND:function(t,e){},M7hm:function(t,e){},NHnr:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});a("EuXz");var n=a("/5sW"),i=a("PlbA"),o=a.n(i),r=(a("VjuZ"),new n["a"]),s={name:"mapitem",props:{map:!1,activeInit:!1},data:function(){return{active:this.activeInit}},methods:{refineTitle:function(t){return t.slice(5).replace(/\.[^/.]+$/,"").replace(/_/g," ")},clicked:function(){this.active?(this.active=!1,r.$emit("clearLayers")):(this.active=!0,r.$emit("selected",this.map))},toggleFullscreen:function(){r.$emit("toggleFullscreen")}},mounted:function(){var t=this;this.active&&r.$emit("selected",this.map),r.$on("selected",function(e){e.id!==t.map.id&&(t.active=!1)})}},c=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.map?a("li",[a("div",{staticClass:"main",on:{click:t.clicked}},[a("img",{attrs:{src:t.map.attributes.thumb_url}}),a("div",[a("h3",[t._v(t._s(t.refineTitle(t.map.attributes.title)))])])]),t.active?a("div",{staticClass:"extended"},[a("button",{staticClass:"mw-ui-button mw-ui-progressive mw-ui-block margin-top-5",on:{click:t.toggleFullscreen}},[t._v("View Map")]),a("h4",[t._v("Open in:")]),a("a",{attrs:{href:"https://commons.wikimedia.org/wiki/File:"+t.map.attributes.unique_id}},[t._v("Wikimedia Commons")]),a("a",{attrs:{href:"https://warper.wmflabs.org/maps/"+t.map.id}},[t._v("Wikimaps Warper")]),a("h4",[t._v("Export as:")]),a("a",{attrs:{href:t.map.links.geotiff,download:""}},[t._v("GeoTiff")]),a("a",{attrs:{href:t.map.links.png,download:""}},[t._v("PNG")]),a("a",{attrs:{href:t.map.links.kml,download:""}},[t._v("KML")]),a("p",[t._v("Copyright holder and licensing information can be found on Wikimedia Commons.")])]):t._e()]):t._e()},u=[],l=a("XyMi");function m(t){a("M7hm")}var p=!1,d=m,f="data-v-48ef5702",h=null,v=Object(l["a"])(s,c,u,p,d,f,h),g=v.exports,b=a("8kuj"),w=a.n(b),_={name:"sidebar",components:{mapitem:g,Spinner:w.a},props:{featuredMap:!1},data:function(){return{searchResult:[],searchText:"",bbox:!1,searchStatus:"not-executed"}},computed:{username:function(){return tt.state.username}},methods:{search:function(t,e){var a=this;e&&e.preventDefault(),this.searchStatus="executing";var n="";r.$emit("getBounds",function(t){n="&bbox=".concat(t.getWest(),",").concat(t.getSouth(),",").concat(t.getEast(),",").concat(t.getNorth())});var i="maps.json?query=".concat(t,"&show_warped=1&per_page=20");this.bbox&&(i+=n),this.searchResult=[],this.$http.get(i).then(function(t){a.searchResult=t.body.data,a.searchStatus="done"})},signIn:function(){var t="https://warper.wmflabs.org",e=window.open(t+"/u/auth/mediawiki?omniauth_window_type=newWindow&auth_origin_url="+window.location.href,"myWindow"),a=setInterval(function(){var a="requestCredentials";e.postMessage(a,t)},500);window.addEventListener("message",function(e){e.origin===t&&(clearInterval(a),tt.commit("signIn",e.data))},!1)},signOut:function(){tt.commit("signOut")}}},k=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"sidebar"},[a("h1",[t._v("Search Maps")]),t.username?t._e():a("button",{staticClass:"mw-ui-button mw-ui-constructive sign-in",on:{click:t.signIn}},[t._v("Sign in")]),t.username?a("button",{staticClass:"mw-ui-button mw-ui-constructive sign-in",attrs:{title:"Signed in as "+t.username},on:{click:t.signOut}},[t._v("Sign out")]):t._e(),a("form",[a("input",{directives:[{name:"model",rawName:"v-model",value:t.searchText,expression:"searchText"}],staticClass:"mw-ui-input",attrs:{type:"text",placeholder:"Search by title"},domProps:{value:t.searchText},on:{input:function(e){e.target.composing||(t.searchText=e.target.value)}}}),a("label",{staticClass:"mw-ui-radio-label margin-top-5"},[t._v("\n            Limit search to current map view.\n            "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.bbox,expression:"bbox"}],staticClass:"mw-ui-checkbox",attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.bbox)?t._i(t.bbox,null)>-1:t.bbox},on:{change:function(e){var a=t.bbox,n=e.target,i=!!n.checked;if(Array.isArray(a)){var o=null,r=t._i(a,o);n.checked?r<0&&(t.bbox=a.concat([o])):r>-1&&(t.bbox=a.slice(0,r).concat(a.slice(r+1)))}else t.bbox=i}}})]),a("button",{staticClass:"mw-ui-button mw-ui-constructive mw-ui-block margin-top-5",on:{click:function(e){t.search(t.searchText,e)}}},[t._v("Search")])]),t.searchResult.length>0||"done"===t.searchStatus?a("h2",[t._v("Search Result")]):t._e(),"executing"===t.searchStatus?a("spinner",{staticClass:"margin-top-14",attrs:{"line-fg-color":"#00af89"}}):t._e(),"done"===t.searchStatus&&0===t.searchResult.length?a("p",[t._v("No results found.")]):t._e(),t.searchResult.length>0?a("ul",{staticClass:"result-list"},t._l(t.searchResult,function(t){return a("mapitem",{key:t.id,attrs:{map:t}})})):t._e(),t.featuredMap?a("h2",[t._v("Featured Map")]):t._e(),t.featuredMap?a("ul",{staticClass:"result-list"},[a("mapitem",{attrs:{map:t.featuredMap,activeInit:!0}})],1):t._e()],1)},x=[];function y(t){a("bpB5")}var C=!1,M=y,S="data-v-4f952a0b",$=null,T=Object(l["a"])(_,k,x,C,M,S,$),O=T.exports,F=(a("mJx5"),a("nrd6")),L=a.n(F),E=(a("kD+0"),a("GfXl"),a("EYnv"),a("FfND"),a("SFzb"),a("e0XP"),{name:"leaflet",mounted:function(){var t=L.a.map("leaflet",{attributionControl:!1,fullscreenControl:!0,center:[40,10],zoom:3});L.a.tileLayer("https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}.png",{attribution:'Background &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(t);var e=L.a.layerGroup().addTo(t);L.a.control.attribution({prefix:""}).addTo(t),t.zoomControl.setPosition("topright"),t.fullscreenControl.setPosition("topright"),L.a.control.locate({position:"topright"}).addTo(t),r.$on("selected",function(a){e.clearLayers(),e.addLayer(L.a.tileLayer.wms(a.links.wms,{layers:"MapWarper",format:"image/png",attribution:'<a href="https://commons.wikimedia.org/wiki/'.concat(a.attributes.title,'">Wikimedia Commons</a>')}));var n=a.attributes.bbox.split(",");t.fitBounds([[n[3],n[2]],[n[1],n[0]]])}),r.$on("clearLayers",function(){e.clearLayers()}),r.$on("getBounds",function(e){e(t.getBounds())}),r.$on("toggleFullscreen",function(){t.toggleFullscreen()})}}),N=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"leaflet"}})},W=[];function I(t){a("7fcv")}var P=!1,j=I,R="data-v-8fd2d8ca",B=null,z=Object(l["a"])(E,N,W,P,j,R,B),G=z.exports,A={name:"app",components:{sidebar:O,leaflet:G},asyncComputed:{featuredMap:{get:function(){var t=["86"];return this.$http.get("maps/"+t[Math.floor(Math.random()*t.length)]).then(function(t){return t.body.data})},default:!1}}},X=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("sidebar",{attrs:{featuredMap:t.featuredMap}}),a("leaflet")],1)},D=[];function V(t){a("+VGo")}var q=!1,Y=V,H=null,J=null,K=Object(l["a"])(A,X,D,q,Y,H,J),Z=K.exports,Q=a("8+8L"),U=a("NYxO");a.d(e,"store",function(){return tt}),n["a"].use(o.a),n["a"].use(Q["a"]),n["a"].use(U["a"]),n["a"].config.productionTip=!1,n["a"].http.options.root="https://warper.wmflabs.org/api/v1";var tt=new U["a"].Store({state:{username:null,token:null},mutations:{signIn:function(t,e){t.token=e.auth_token,t.username=e.name},signOut:function(t){t.token=null,t.username=null}}});new n["a"]({render:function(t){return t(Z)}}).$mount("#app")},SFzb:function(t,e){},bpB5:function(t,e){},e0XP:function(t,e){}},[0]);
//# sourceMappingURL=app.c112bfe7.js.map